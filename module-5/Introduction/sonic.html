<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Sonic Example</title>
    <style>
      .prevent-select {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
      }
    </style>
    <!-- Import map: map the bare specifier "three" to the local module build. -->
    <script type="importmap">
      {
        "imports": {
          "libSprite": "../../common/script/libSprite.mjs",
          "lib2d": "../../common/script/lib2d.mjs"
        }
      }
    </script>
  </head>
  <body class="prevent-select">
    <canvas id="cvs" style="background-color: antiquewhite" width="1024" height="512"></canvas>
  </body>
  <script type = "module" defer>
  import {TSpriteCanvas, TSprite} from "libSprite";

  
    const SpriteInfoList = {
    sonic1: { x: 0, y:   0, width: 102, height: 125, count: 6},
    sonic2: { x: 0, y: 125, width: 102, height: 125, count: 9},
    sonic3: { x: 0, y: 250, width: 102, height: 125, count: 9},
    sonic4: { x: 0, y: 375, width: 102, height:  75, count: 7},
    sonic5: { x: 0, y: 450, width: 100, height: 130, count: 5},
    sonic6: { x: 0, y: 575, width: 102, height: 125, count: 3},
    sonic7: { x: 0, y: 700, width: 102, height: 125, count: 2},
    sonic8: { x: 0, y: 825, width: 102, height: 125, count: 2},
    sonic9: { x: 0, y: 955, width: 102, height: 140, count: 4}
  }

    const cvs = document.getElementById("cvs");
    const ctx = cvs.getContext("2d");
    const spcvs = new TSpriteCanvas(cvs);
    const hero1 = new TSprite(spcvs, SpriteInfoList.sonic2, 0, 100);
    const hero2 = new TSprite(spcvs, SpriteInfoList.sonic1, 0, 250);
    const hero3 = new TSprite(spcvs, SpriteInfoList.sonic3, 0, 350);
    const hero4 = new TSprite(spcvs, SpriteInfoList.sonic9, 500, 250);




    //functions 
    function drawCanvas(){
    hero1.draw();
    hero2.draw();
    hero3.draw();
    hero4.draw();
  }
  let dir = 1; // 1 = right, -1 = left
  function animate(){
    console.log("animate")
    hero1.x += 3*dir;
    if((hero1.x > cvs.width - hero1.width)||(hero1.x + hero1.width < 0 && dir <0)){
      dir *= -1;
      hero1.flipHorizontal();
      hero2.hidden = !hero2.hidden;
      // hero3.hidden = !hero3.hidden ;
      // hero4.hidden = !hero4.hidden ;
    }
  }
  

  function sheetLoaded(){
    console.log("Sheet loaded");
    spcvs.showFramerate = true;
    spcvs.onDraw = drawCanvas;
    hero1.animationSpeed = 10;
    hero1.rotation = 0;

    hero2.animationSpeed = 3;
    hero2.rotation = 0;
    hero2.hidden = true;

    hero3.animationSpeed = 10;
    hero3.rotation = 0;
    hero3.hidden = true; 

    hero4.animationSpeed = 10;
    hero4.rotation = 0; 
    hero4.hidden = true;
    // hero1.flipHorizontal() = true;
    // setInterval(animate, 20);
    setInterval(onKeyDown, 20)
  }

  function onKeyDown(aEvent){
    switch(aEvent.code){
      case "ArrowUp":
        hero1.y -= 5;
        console.log("arrow up");
      break;
      case"ArrowRight":
        hero1.x += 5; 
      break;
      case "ArrowDown":
        hero1.y += 5;
      break;
      case "ArrowLeft":
        hero1.x -= 5;
      break;
    }
  }

 
    //main application 
    spcvs.loadSpriteImage("sonic_sprite_sheet.png", sheetLoaded);
    document.addEventListener("keydown", onKeyDown);
    </script>
</html>
